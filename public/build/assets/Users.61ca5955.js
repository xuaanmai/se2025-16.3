import{m as F,p as w,g as $,E as P,A as E,o as i,c,a as e,t as g,i as S,G as l,j as x,k as y,v as _,bQ as N,H as U,I as C,h as V,F as q}from"./app.0ff6d003.js";import{u as M}from"./referentials.a5cb365e.js";const j=F("users",{state:()=>({users:[],user:null,pagination:{currentPage:1,totalPages:1,total:0,perPage:15},loading:!1,error:null}),actions:{async fetchUsers(p=1,s={}){this.loading=!0,this.error=null;try{const m={page:p,...s},a=await w.get("/users",{params:m});this.users=a.data.data,this.pagination={currentPage:a.data.meta.current_page,totalPages:a.data.meta.last_page,total:a.data.meta.total,perPage:a.data.meta.per_page}}catch(m){this.error="Failed to fetch users.",console.error(m)}finally{this.loading=!1}},async createUser(p){var s,m,a,n;this.loading=!0,this.error=null;try{const d=await w.post("/users",p);return await this.fetchUsers(),d.data.data}catch(d){throw this.error=((m=(s=d.response)==null?void 0:s.data)==null?void 0:m.message)||"Failed to create user.",(n=(a=d.response)==null?void 0:a.data)!=null&&n.errors&&(this.error=Object.values(d.response.data.errors).flat().join(" ")),console.error(d),d}finally{this.loading=!1}},async updateUser(p,s){var m,a,n,d;this.loading=!0,this.error=null;try{const o=await w.put(`/users/${p}`,s);return await this.fetchUsers(this.pagination.currentPage),o.data.data}catch(o){throw this.error=((a=(m=o.response)==null?void 0:m.data)==null?void 0:a.message)||"Failed to update user.",(d=(n=o.response)==null?void 0:n.data)!=null&&d.errors&&(this.error=Object.values(o.response.data.errors).flat().join(" ")),console.error(o),o}finally{this.loading=!1}},async deleteUser(p){this.loading=!0,this.error=null;try{await w.delete(`/users/${p}`),await this.fetchUsers(this.pagination.currentPage)}catch(s){throw this.error="Failed to delete user.",console.error(s),s}finally{this.loading=!1}}}}),B={class:"relative mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white"},O={class:"mt-3 text-center"},R={class:"text-lg leading-6 font-medium text-gray-900"},A={key:0,class:"mb-4 rounded-md bg-red-50 p-4"},H={class:"text-sm font-medium text-red-800"},L={class:"mb-4"},T={class:"mb-4"},D={key:1,class:"mb-4"},G=["required"],I={key:2,class:"mb-4"},Q=["required"],z={class:"mb-4"},J=["value"],K={class:"items-center px-4 py-3"},W=["disabled"],X={__name:"UserFormModal",props:{user:{type:Object,default:null}},emits:["close","save"],setup(p,{emit:s}){const m=p,a=s,n=j(),d=M(),o=$({id:null,name:"",email:"",password:"",password_confirmation:"",roles:[]}),b=P(()=>!!m.user),h=P(()=>b.value?"Edit User":"Create New User");E(()=>m.user,u=>{u?o.value={id:u.id,name:u.name,email:u.email,password:"",password_confirmation:"",roles:u.roles.map(t=>t.id)}:o.value={id:null,name:"",email:"",password:"",password_confirmation:"",roles:[]},n.error=null},{immediate:!0});const k=()=>{const u={...o.value};b.value&&!u.password&&(delete u.password,delete u.password_confirmation),a("save",u)};return(u,t)=>(i(),c("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center",onClick:t[6]||(t[6]=S(r=>u.$emit("close"),["self"]))},[e("div",B,[e("div",O,[e("h3",R,g(h.value),1),e("form",{onSubmit:S(k,["prevent"]),class:"mt-2 px-7 py-3 text-left"},[l(n).error?(i(),c("div",A,[e("p",H,g(l(n).error),1)])):x("",!0),e("div",L,[t[7]||(t[7]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Full Name",-1)),y(e("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=r=>o.value.name=r),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[_,o.value.name]])]),e("div",T,[t[8]||(t[8]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Email",-1)),y(e("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=r=>o.value.email=r),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[_,o.value.email]])]),b.value?x("",!0):(i(),c("div",D,[t[9]||(t[9]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Password",-1)),y(e("input",{type:"password",id:"password","onUpdate:modelValue":t[2]||(t[2]=r=>o.value.password=r),required:!b.value,class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,8,G),[[_,o.value.password]])])),b.value?x("",!0):(i(),c("div",I,[t[10]||(t[10]=e("label",{for:"password_confirmation",class:"block text-sm font-medium text-gray-700"},"Confirm Password",-1)),y(e("input",{type:"password",id:"password_confirmation","onUpdate:modelValue":t[3]||(t[3]=r=>o.value.password_confirmation=r),required:!b.value,class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,8,Q),[[_,o.value.password_confirmation]])])),e("div",z,[t[11]||(t[11]=e("label",{for:"roles",class:"block text-sm font-medium text-gray-700"},"Roles",-1)),y(e("select",{id:"roles","onUpdate:modelValue":t[4]||(t[4]=r=>o.value.roles=r),multiple:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},[(i(!0),c(U,null,C(l(d).roles,r=>(i(),c("option",{key:r.id,value:r.id},g(r.name),9,J))),128))],512),[[N,o.value.roles]]),t[12]||(t[12]=e("p",{class:"text-xs text-gray-500 mt-1"},"Hold Ctrl or Cmd to select multiple roles.",-1))]),e("div",K,[e("button",{type:"submit",disabled:l(n).loading,class:"w-full px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"},g(l(n).loading?"Saving...":"Save User"),9,W),e("button",{type:"button",onClick:t[5]||(t[5]=r=>u.$emit("close")),class:"w-full px-4 py-2 mt-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Cancel ")])],32)])])]))}},Y={key:0,class:"text-center py-10"},Z={key:1,class:"text-center py-10 text-red-500"},ee={key:2,class:"bg-white shadow-md rounded-lg overflow-hidden"},te={class:"min-w-full leading-normal"},se={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},re={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},oe={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},ae={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm text-right"},le=["onClick"],ne=["onClick"],ie={key:0},de={class:"px-5 py-5 bg-white border-t flex flex-col xs:flex-row items-center xs:justify-between"},ue={class:"text-xs xs:text-sm text-gray-900"},ce={class:"inline-flex mt-2 xs:mt-0"},me=["disabled"],pe=["disabled"],fe={__name:"Users",setup(p){const s=j(),m=M(),a=$(!1),n=$(null);V(()=>{s.fetchUsers(),m.fetchAllReferentials()});const d=t=>{t>0&&t<=s.pagination.totalPages&&s.fetchUsers(t)},o=()=>{n.value=null,a.value=!0},b=t=>{n.value={...t},a.value=!0},h=()=>{a.value=!1,n.value=null},k=async t=>{t.id?await s.updateUser(t.id,t):await s.createUser(t),s.error||h()},u=t=>{window.confirm(`Are you sure you want to delete the user "${t.name}"?`)&&s.deleteUser(t.id)};return(t,r)=>(i(),c("div",null,[e("div",{class:"flex justify-end mb-6"},[e("button",{onClick:o,class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700"}," Create User ")]),l(s).loading?(i(),c("div",Y,"Loading users...")):l(s).error?(i(),c("div",Z,g(l(s).error),1)):(i(),c("div",ee,[e("table",te,[r[3]||(r[3]=e("thead",null,[e("tr",null,[e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Name "),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Email "),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Roles "),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100"})])],-1)),e("tbody",null,[(i(!0),c(U,null,C(l(s).users,f=>(i(),c("tr",{key:f.id,class:"hover:bg-gray-50"},[e("td",se,g(f.name),1),e("td",re,g(f.email),1),e("td",oe,[(i(!0),c(U,null,C(f.roles,v=>(i(),c("span",{key:v.id,class:"mr-2 inline-block px-2 py-1 text-xs font-semibold text-gray-700 bg-gray-200 rounded-full"},g(v.name),1))),128))]),e("td",ae,[e("button",{onClick:v=>b(f),class:"text-indigo-600 hover:text-indigo-900 mr-4"},"Edit",8,le),e("button",{onClick:v=>u(f),class:"text-red-600 hover:text-red-900"},"Delete",8,ne)])]))),128)),l(s).users.length===0?(i(),c("tr",ie,[...r[2]||(r[2]=[e("td",{colspan:"4",class:"text-center py-10 text-gray-500"},"No users found.",-1)])])):x("",!0)])]),e("div",de,[e("span",ue," Showing "+g(l(s).users.length)+" of "+g(l(s).pagination.total)+" users ",1),e("div",ce,[e("button",{onClick:r[0]||(r[0]=f=>d(l(s).pagination.currentPage-1)),disabled:l(s).pagination.currentPage<=1,class:"text-sm bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-l disabled:opacity-50"}," Prev ",8,me),e("button",{onClick:r[1]||(r[1]=f=>d(l(s).pagination.currentPage+1)),disabled:l(s).pagination.currentPage>=l(s).pagination.totalPages,class:"text-sm bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-r disabled:opacity-50"}," Next ",8,pe)])])])),a.value?(i(),q(X,{key:3,user:n.value,onClose:h,onSave:k},null,8,["user"])):x("",!0)]))}};export{fe as default};
