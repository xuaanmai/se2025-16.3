import{_ as $,f as B,g as T,E as x,A as U,o as l,c as a,a as i,t as n,i as M,G as u,j as w,k as r,bQ as k,H as v,I as f,v as g}from"./app.0ff6d003.js";import{u as O}from"./tickets.d64acf6c.js";import{u as R}from"./projects.9a7d75e0.js";import{u as z}from"./referentials.a5cb365e.js";const G={class:"relative mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white"},H={class:"mt-3"},Q={class:"text-lg leading-6 font-medium text-gray-900 text-center"},J={key:0,class:"mb-4 rounded-md bg-red-50 p-4"},K={class:"text-sm font-medium text-red-800"},W={key:1},X=["value"],Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Z=["value"],h=["value"],ee={key:0},te=["value"],ie=["disabled"],se={key:0,value:""},oe=["label"],le=["value"],ae={class:"items-center pt-4"},re=["disabled"],de={__name:"TicketFormModal",props:{ticket:{type:Object,default:null}},emits:["close","save"],setup(P,{emit:A}){const b=P,D=A,y=O(),F=R(),d=z(),I=B(),o=T({}),p=T([]),_=T(!1),j=x(()=>!!(b.ticket&&b.ticket.id)),q=x(()=>j.value||b.ticket&&b.ticket.project_id),C=x(()=>j.value?"Edit Ticket":"Create New Ticket"),V=s=>s?new Date(s).toISOString().split("T")[0]:"",E=s=>{var t,m,c;const e={id:null,name:"",description:"",project_id:"",owner_id:(t=I.user)==null?void 0:t.id,responsible_id:"",status_id:"",priority_id:((m=d.ticketPriorities.find(S=>S.is_default))==null?void 0:m.id)||"",type_id:((c=d.ticketTypes.find(S=>S.is_default))==null?void 0:c.id)||"",estimation:null,start_date:"",due_date:""};s?o.value={...e,id:s.id,name:s.name,description:s.description||"",project_id:s.project_id,responsible_id:s.responsible_id||"",status_id:s.status_id,priority_id:s.priority_id,type_id:s.type_id,estimation:s.estimation,start_date:V(s.start_date),due_date:V(s.due_date)}:o.value=e,y.error=null},N=x(()=>p.value?p.value.reduce((s,e)=>{const t=e.pivot.role||"Unknown";return s[t]||(s[t]=[]),s[t].push(e),s},{}):{});U(()=>b.ticket,async s=>{d.isLoaded||await d.fetchAllReferentials(),console.log("Statuses available to form:",d.ticketStatuses),E(s)},{immediate:!0}),U(()=>o.value.project_id,async(s,e)=>{s?(_.value=!0,p.value=await F.fetchProjectMembers(s),_.value=!1,Array.isArray(p.value)&&p.value.some(m=>m.id===o.value.responsible_id)||(o.value.responsible_id="")):p.value=[]},{immediate:!0});const L=()=>{D("save",{...o.value})};return(s,e)=>(l(),a("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center",onClick:e[11]||(e[11]=M(t=>s.$emit("close"),["self"]))},[i("div",G,[i("div",H,[i("h3",Q,n(C.value),1),i("form",{onSubmit:M(L,["prevent"]),class:"mt-4 px-4 py-3 text-left space-y-4"},[u(y).error?(l(),a("div",J,[i("p",K,n(u(y).error),1)])):w("",!0),q.value?w("",!0):(l(),a("div",W,[e[13]||(e[13]=i("label",{for:"ticket-project",class:"block text-sm font-medium text-gray-700"},"Project",-1)),r(i("select",{id:"ticket-project","onUpdate:modelValue":e[0]||(e[0]=t=>o.value.project_id=t),required:"",class:"mt-1 form-select"},[e[12]||(e[12]=i("option",{disabled:"",value:""},"Please select a project",-1)),(l(!0),a(v,null,f(u(d).projects,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,X))),128))],512),[[k,o.value.project_id]])])),i("div",null,[e[14]||(e[14]=i("label",{for:"ticket-name",class:"block text-sm font-medium text-gray-700"},"Ticket Title",-1)),r(i("input",{type:"text",id:"ticket-name","onUpdate:modelValue":e[1]||(e[1]=t=>o.value.name=t),required:"",class:"mt-1 form-input"},null,512),[[g,o.value.name]])]),i("div",Y,[i("div",null,[e[15]||(e[15]=i("label",{for:"ticket-type",class:"block text-sm font-medium text-gray-700"},"Type",-1)),r(i("select",{id:"ticket-type","onUpdate:modelValue":e[2]||(e[2]=t=>o.value.type_id=t),required:"",class:"mt-1 form-select"},[(l(!0),a(v,null,f(u(d).ticketTypes,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,Z))),128))],512),[[k,o.value.type_id]])]),i("div",null,[e[16]||(e[16]=i("label",{for:"ticket-priority",class:"block text-sm font-medium text-gray-700"},"Priority",-1)),r(i("select",{id:"ticket-priority","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.priority_id=t),required:"",class:"mt-1 form-select"},[(l(!0),a(v,null,f(u(d).ticketPriorities,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,h))),128))],512),[[k,o.value.priority_id]])]),j.value?(l(),a("div",ee,[e[17]||(e[17]=i("label",{for:"ticket-status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),r(i("select",{id:"ticket-status","onUpdate:modelValue":e[4]||(e[4]=t=>o.value.status_id=t),required:"",class:"mt-1 form-select"},[(l(!0),a(v,null,f(u(d).ticketStatuses,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,te))),128))],512),[[k,o.value.status_id]])])):w("",!0),i("div",null,[e[19]||(e[19]=i("label",{for:"ticket-assignee",class:"block text-sm font-medium text-gray-700"},"Assignee",-1)),r(i("select",{id:"ticket-assignee","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.responsible_id=t),class:"mt-1 form-select",disabled:!o.value.project_id||_.value},[e[18]||(e[18]=i("option",{value:""},"Unassigned",-1)),_.value?(l(),a("option",se,"Loading members...")):w("",!0),(l(!0),a(v,null,f(N.value,(t,m)=>(l(),a("optgroup",{key:m,label:m},[(l(!0),a(v,null,f(t,c=>(l(),a("option",{key:c.id,value:c.id},n(c.name),9,le))),128))],8,oe))),128))],8,ie),[[k,o.value.responsible_id]])]),i("div",null,[e[20]||(e[20]=i("label",{for:"ticket-estimation",class:"block text-sm font-medium text-gray-700"},"Estimation (hours)",-1)),r(i("input",{type:"number",step:"0.5",min:"0",id:"ticket-estimation","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.estimation=t),class:"mt-1 form-input"},null,512),[[g,o.value.estimation]])]),i("div",null,[e[21]||(e[21]=i("label",{for:"ticket-start-date",class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),r(i("input",{type:"date",id:"ticket-start-date","onUpdate:modelValue":e[7]||(e[7]=t=>o.value.start_date=t),class:"mt-1 form-input"},null,512),[[g,o.value.start_date]])]),i("div",null,[e[22]||(e[22]=i("label",{for:"ticket-due-date",class:"block text-sm font-medium text-gray-700"},"Due Date",-1)),r(i("input",{type:"date",id:"ticket-due-date","onUpdate:modelValue":e[8]||(e[8]=t=>o.value.due_date=t),class:"mt-1 form-input"},null,512),[[g,o.value.due_date]])])]),i("div",null,[e[23]||(e[23]=i("label",{for:"ticket-description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),r(i("textarea",{id:"ticket-description","onUpdate:modelValue":e[9]||(e[9]=t=>o.value.description=t),rows:"4",class:"mt-1 form-input"},null,512),[[g,o.value.description]])]),i("div",ae,[i("button",{type:"submit",disabled:u(y).loading,class:"w-full px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"},n(u(y).loading?"Saving...":"Save Ticket"),9,re),i("button",{type:"button",onClick:e[10]||(e[10]=t=>s.$emit("close")),class:"w-full px-4 py-2 mt-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Cancel ")])],32)])])]))}},ce=$(de,[["__scopeId","data-v-17727159"]]);export{ce as T};
