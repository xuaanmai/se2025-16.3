import{f as $,g as m,h as B,A as E,r as F,o as r,c as i,a as e,k as y,bQ as x,H as c,I as p,G as l,t as n,j as S,F as D,d as L,w as R,J as C}from"./app.0ff6d003.js";import{u as z}from"./tickets.d64acf6c.js";import{u as G}from"./referentials.a5cb365e.js";import{T as H}from"./TicketFormModal.6fd47471.js";import"./projects.9a7d75e0.js";const I={class:"mb-6 bg-white p-4 rounded-lg shadow"},J={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},O=["value"],Q=["value"],q=["value"],K=["value"],W={key:0,class:"text-center py-10"},X={key:1,class:"text-center py-10 text-red-500"},Y={key:2,class:"bg-white shadow-md rounded-lg overflow-hidden"},Z={class:"min-w-full leading-normal"},ee={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},te={class:"text-gray-900 whitespace-no-wrap font-bold"},oe={class:"text-gray-600 whitespace-no-wrap"},se={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},re={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},le={class:"relative"},ie={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},ae={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},ne={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm text-right"},de=["onClick"],ue=["onClick"],ce={key:0},pe={class:"px-5 py-5 bg-white border-t flex flex-col xs:flex-row items-center xs:justify-between"},be={class:"text-xs xs:text-sm text-gray-900"},ge={class:"inline-flex mt-2 xs:mt-0"},ye=["disabled"],xe=["disabled"],we={__name:"Tickets",setup(me){const s=z(),u=G();$();const b=m(!1),g=m(null),d=m({project_id:"",status_id:"",priority_id:"",type_id:""});B(()=>{u.fetchAllReferentials(),s.fetchTickets(1,d.value)}),E(d,()=>{s.fetchTickets(1,d.value)},{deep:!0});const f=a=>{a>0&&a<=s.pagination.totalPages&&s.fetchTickets(a,d.value)},j=()=>{g.value=null,b.value=!0},A=a=>{g.value={...a},b.value=!0},v=()=>{b.value=!1,g.value=null},M=async a=>{a.id?await s.updateTicket(a.id,a):await s.createTicket(a),s.error||v()},V=a=>{window.confirm(`Are you sure you want to delete the ticket "${a.name}"?`)&&s.deleteTicket(a.id)};return(a,o)=>{const N=F("router-link");return r(),i("div",null,[e("div",{class:"flex justify-end mb-6"},[e("button",{onClick:j,class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700"}," Create Ticket ")]),e("div",I,[e("div",J,[e("div",null,[o[7]||(o[7]=e("label",{for:"project-filter",class:"block text-sm font-medium text-gray-700"},"Project",-1)),y(e("select",{id:"project-filter","onUpdate:modelValue":o[0]||(o[0]=t=>d.value.project_id=t),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"},[o[6]||(o[6]=e("option",{value:""},"All Projects",-1)),(r(!0),i(c,null,p(l(u).projects,t=>(r(),i("option",{key:t.id,value:t.id},n(t.name),9,O))),128))],512),[[x,d.value.project_id]])]),e("div",null,[o[9]||(o[9]=e("label",{for:"status-filter",class:"block text-sm font-medium text-gray-700"},"Status",-1)),y(e("select",{id:"status-filter","onUpdate:modelValue":o[1]||(o[1]=t=>d.value.status_id=t),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"},[o[8]||(o[8]=e("option",{value:""},"All Statuses",-1)),(r(!0),i(c,null,p(l(u).ticketStatuses,t=>(r(),i("option",{key:t.id,value:t.id},n(t.name),9,Q))),128))],512),[[x,d.value.status_id]])]),e("div",null,[o[11]||(o[11]=e("label",{for:"priority-filter",class:"block text-sm font-medium text-gray-700"},"Priority",-1)),y(e("select",{id:"priority-filter","onUpdate:modelValue":o[2]||(o[2]=t=>d.value.priority_id=t),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"},[o[10]||(o[10]=e("option",{value:""},"All Priorities",-1)),(r(!0),i(c,null,p(l(u).ticketPriorities,t=>(r(),i("option",{key:t.id,value:t.id},n(t.name),9,q))),128))],512),[[x,d.value.priority_id]])]),e("div",null,[o[13]||(o[13]=e("label",{for:"type-filter",class:"block text-sm font-medium text-gray-700"},"Type",-1)),y(e("select",{id:"type-filter","onUpdate:modelValue":o[3]||(o[3]=t=>d.value.type_id=t),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"},[o[12]||(o[12]=e("option",{value:""},"All Types",-1)),(r(!0),i(c,null,p(l(u).ticketTypes,t=>(r(),i("option",{key:t.id,value:t.id},n(t.name),9,K))),128))],512),[[x,d.value.type_id]])])])]),l(s).loading?(r(),i("div",W,"Loading tickets...")):l(s).error?(r(),i("div",X,n(l(s).error),1)):(r(),i("div",Y,[e("table",Z,[o[15]||(o[15]=e("thead",null,[e("tr",null,[e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Ticket"),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Project"),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Status"),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Priority"),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"},"Assignee"),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100"})])],-1)),e("tbody",null,[(r(!0),i(c,null,p(l(s).tickets,t=>{var k,_,h,w,T,P;return r(),i("tr",{key:t.id,class:"hover:bg-gray-50"},[e("td",ee,[L(N,{to:{name:"TicketDetail",params:{id:t.id}},class:"block hover:text-blue-600"},{default:R(()=>[e("p",te,n(t.code),1),e("p",oe,n(t.name),1)]),_:2},1032,["to"])]),e("td",se,n((k=t.project)==null?void 0:k.name),1),e("td",re,[e("span",{class:"relative inline-block px-3 py-1 font-semibold leading-tight",style:C({color:(_=t.status)==null?void 0:_.color})},[e("span",{"aria-hidden":"",class:"absolute inset-0 opacity-20 rounded-full",style:C({backgroundColor:(h=t.status)==null?void 0:h.color})},null,4),e("span",le,n(((w=t.status)==null?void 0:w.name)||"N/A"),1)],4)]),e("td",ie,n((T=t.priority)==null?void 0:T.name),1),e("td",ae,n(((P=t.responsible)==null?void 0:P.name)||"Unassigned"),1),e("td",ne,[e("button",{onClick:U=>A(t),class:"text-indigo-600 hover:text-indigo-900 mr-4"},"Edit",8,de),e("button",{onClick:U=>V(t),class:"text-red-600 hover:text-red-900"},"Delete",8,ue)])])}),128)),l(s).tickets.length===0?(r(),i("tr",ce,[...o[14]||(o[14]=[e("td",{colspan:"6",class:"text-center py-10 text-gray-500"},"No tickets found.",-1)])])):S("",!0)])]),e("div",pe,[e("span",be," Showing "+n(l(s).tickets.length)+" of "+n(l(s).pagination.total)+" tickets ",1),e("div",ge,[e("button",{onClick:o[4]||(o[4]=t=>f(l(s).pagination.currentPage-1)),disabled:l(s).pagination.currentPage<=1,class:"text-sm bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-l disabled:opacity-50"}," Prev ",8,ye),e("button",{onClick:o[5]||(o[5]=t=>f(l(s).pagination.currentPage+1)),disabled:l(s).pagination.currentPage>=l(s).pagination.totalPages,class:"text-sm bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-r disabled:opacity-50"}," Next ",8,xe)])])])),b.value?(r(),D(H,{key:3,ticket:g.value,onClose:v,onSave:M},null,8,["ticket"])):S("",!0)])}}};export{we as default};
