import{m as n,p as o,f as h}from"./app.0ff6d003.js";const p=n("projects",{state:()=>({projects:[],project:null,pagination:{currentPage:1,totalPages:1,total:0,perPage:15},loading:!1,error:null}),actions:{async fetchProjects(e=1,t={}){this.loading=!0,this.error=null;try{const r={page:e,...t},a=(await o.get("/projects",{params:r})).data||{},i=a.meta||{},c=a.data||[];this.projects=c,this.pagination={currentPage:i.current_page||1,totalPages:i.last_page||1,total:i.total||0,perPage:i.per_page||15}}catch(r){this.error="Failed to fetch projects.",console.error(r)}finally{this.loading=!1}},async fetchProject(e){this.loading=!0,this.error=null,this.project=null;try{const t=await o.get(`/projects/${e}`);this.project=t.data}catch(t){this.error="Failed to fetch project details.",console.error(t)}finally{this.loading=!1}},async createProject(e){var t,r;this.loading=!0,this.error=null;try{const s=await o.post("/projects",e,{headers:{"Content-Type":"multipart/form-data"}});return await this.fetchProjects(),await h().fetchUser(),s.data.data}catch(s){throw this.error=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to create project.",console.error(s),s}finally{this.loading=!1}},async updateProject(e,t){var r,s;this.loading=!0,this.error=null;try{const a=await o.post(`/projects/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}});return await this.fetchProjects(this.pagination.currentPage),this.project&&this.project.id===e&&(this.project=a.data.data),a.data.data}catch(a){throw this.error=((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to update project.",console.error(a),a}finally{this.loading=!1}},async deleteProject(e){this.loading=!0,this.error=null;try{await o.delete(`/projects/${e}`),await this.fetchProjects(this.pagination.currentPage)}catch(t){throw this.error="Failed to delete project.",console.error(t),t}finally{this.loading=!1}},async toggleFavorite(e){try{const t=await o.post(`/projects/${e}/favorite`),r=this.projects.findIndex(s=>s.id===e);r!==-1&&(this.projects[r].is_favorite=t.data.is_favorite)}catch(t){console.error("Failed to toggle favorite status:",t)}},async fetchProjectMembers(e){try{const r=(await o.get(`/projects/${e}/users`)).data||[];return this.project&&this.project.id==e&&(this.project.users=r),r}catch(t){return console.error("Failed to fetch project members:",t),[]}},async attachUser(e,t){var r,s;try{await o.post(`/projects/${e}/users`,t),await this.fetchProjectMembers(e)}catch(a){throw console.error("Failed to attach user:",a),this.error=((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to attach user.",a}},async updateUserRole(e,t,r){var s,a;try{await o.put(`/projects/${e}/users/${t}`,{role:r}),await this.fetchProjectMembers(e)}catch(i){throw console.error("Failed to update user role:",i),this.error=((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to update role.",i}},async detachUser(e,t){var r,s;try{await o.delete(`/projects/${e}/users/${t}`),await this.fetchProjectMembers(e)}catch(a){throw console.error("Failed to detach user:",a),this.error=((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to detach user.",a}},async fetchSprints(e){try{const t=await o.get(`/projects/${e}/sprints`);return this.project&&this.project.id==e&&(this.project.sprints=t.data),t.data}catch(t){return console.error("Failed to fetch sprints:",t),[]}},async fetchActiveProjects(e=1){this.loading=!0,this.error=null;try{const t=await o.get(`/projects/active?page=${e}`);this.projects=t.data.data,this.pagination.currentPage=t.data.current_page,this.pagination.totalPages=t.data.last_page,this.pagination.total=t.data.total}catch(t){this.error="Failed to fetch active projects.",console.error(t)}finally{this.loading=!1}}}});export{p as u};
