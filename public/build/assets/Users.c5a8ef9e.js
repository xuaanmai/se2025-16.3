import{m as F,p as y,g as $,E as C,A as E,o as u,c as m,a as e,t as g,i as S,G as i,j as x,k as h,v as _,bQ as N,H as P,I as U,h as V,F as q}from"./app.c4cf1d9c.js";import{u as j}from"./referentials.d9e3f896.js";const M=F("users",{state:()=>({users:[],user:null,pagination:{currentPage:1,totalPages:1,total:0,perPage:15},loading:!1,error:null}),actions:{async fetchUsers(p=1,s={}){var d;this.loading=!0,this.error=null;try{const n={page:p,...s},r=await y.get("/users",{params:n});r.data.meta?(this.users=r.data.data,this.pagination={currentPage:r.data.meta.current_page,totalPages:r.data.meta.last_page,total:r.data.meta.total,perPage:r.data.meta.per_page}):(this.users=(d=r.data.data)!=null?d:r.data,this.pagination={currentPage:1,totalPages:1,total:this.users.length,perPage:this.users.length})}catch(n){this.error="Failed to fetch users.",console.error(n)}finally{this.loading=!1}},async createUser(p){var s,d,n,r;this.loading=!0,this.error=null;try{const l=await y.post("/users",p);return await this.fetchUsers(this.pagination.currentPage),l.data.data}catch(l){throw this.error=((d=(s=l.response)==null?void 0:s.data)==null?void 0:d.message)||Object.values(((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.errors)||{}).flat().join(" ")||"Failed to create user.",console.error(l),l}finally{this.loading=!1}},async updateUser(p,s){var d,n,r,l;this.loading=!0,this.error=null;try{const a=await y.put(`/users/${p}`,s);return await this.fetchUsers(this.pagination.currentPage),a.data.data}catch(a){throw this.error=((n=(d=a.response)==null?void 0:d.data)==null?void 0:n.message)||Object.values(((l=(r=a.response)==null?void 0:r.data)==null?void 0:l.errors)||{}).flat().join(" ")||"Failed to update user.",console.error(a),a}finally{this.loading=!1}},async deleteUser(p){this.loading=!0,this.error=null;try{await y.delete(`/users/${p}`),await this.fetchUsers(this.pagination.currentPage)}catch(s){throw this.error="Failed to delete user.",console.error(s),s}finally{this.loading=!1}},async updateMe(p){var s,d,n,r;this.loading=!0,this.error=null;try{const l=await y.put("/users/me",p);return this.user=l.data.data,this.user}catch(l){throw this.error=((d=(s=l.response)==null?void 0:s.data)==null?void 0:d.message)||Object.values(((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.errors)||{}).flat().join(" ")||"Failed to update profile.",l}finally{this.loading=!1}}}}),O={class:"relative mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white"},B={class:"mt-3 text-center"},R={class:"text-lg leading-6 font-medium text-gray-900"},A={key:0,class:"mb-4 rounded-md bg-red-50 p-4"},H={class:"text-sm font-medium text-red-800"},L={class:"mb-4"},T={class:"mb-4"},D={key:1,class:"mb-4"},G=["required"],I={key:2,class:"mb-4"},Q=["required"],z={class:"mb-4"},J=["value"],K={class:"items-center px-4 py-3"},W=["disabled"],X={__name:"UserFormModal",props:{user:{type:Object,default:null}},emits:["close","save"],setup(p,{emit:s}){const d=p,n=s,r=M(),l=j(),a=$({id:null,name:"",email:"",password:"",password_confirmation:"",roles:[]}),b=C(()=>!!d.user),w=C(()=>b.value?"Edit User":"Create New User");E(()=>d.user,c=>{c?a.value={id:c.id,name:c.name,email:c.email,password:"",password_confirmation:"",roles:c.roles.map(t=>t.id)}:a.value={id:null,name:"",email:"",password:"",password_confirmation:"",roles:[]},r.error=null},{immediate:!0});const k=()=>{const c={...a.value};b.value&&!c.password&&(delete c.password,delete c.password_confirmation),n("save",c)};return(c,t)=>(u(),m("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center",onClick:t[6]||(t[6]=S(o=>c.$emit("close"),["self"]))},[e("div",O,[e("div",B,[e("h3",R,g(w.value),1),e("form",{onSubmit:S(k,["prevent"]),class:"mt-2 px-7 py-3 text-left"},[i(r).error?(u(),m("div",A,[e("p",H,g(i(r).error),1)])):x("",!0),e("div",L,[t[7]||(t[7]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Full Name",-1)),h(e("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=o=>a.value.name=o),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[_,a.value.name]])]),e("div",T,[t[8]||(t[8]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Email",-1)),h(e("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.email=o),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,512),[[_,a.value.email]])]),b.value?x("",!0):(u(),m("div",D,[t[9]||(t[9]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Password",-1)),h(e("input",{type:"password",id:"password","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.password=o),required:!b.value,class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,8,G),[[_,a.value.password]])])),b.value?x("",!0):(u(),m("div",I,[t[10]||(t[10]=e("label",{for:"password_confirmation",class:"block text-sm font-medium text-gray-700"},"Confirm Password",-1)),h(e("input",{type:"password",id:"password_confirmation","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.password_confirmation=o),required:!b.value,class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,8,Q),[[_,a.value.password_confirmation]])])),e("div",z,[t[11]||(t[11]=e("label",{for:"roles",class:"block text-sm font-medium text-gray-700"},"Roles",-1)),h(e("select",{id:"roles","onUpdate:modelValue":t[4]||(t[4]=o=>a.value.roles=o),multiple:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},[(u(!0),m(P,null,U(i(l).roles,o=>(u(),m("option",{key:o.id,value:o.id},g(o.name),9,J))),128))],512),[[N,a.value.roles]]),t[12]||(t[12]=e("p",{class:"text-xs text-gray-500 mt-1"},"Hold Ctrl or Cmd to select multiple roles.",-1))]),e("div",K,[e("button",{type:"submit",disabled:i(r).loading,class:"w-full px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"},g(i(r).loading?"Saving...":"Save User"),9,W),e("button",{type:"button",onClick:t[5]||(t[5]=o=>c.$emit("close")),class:"w-full px-4 py-2 mt-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Cancel ")])],32)])])]))}},Y={key:0,class:"text-center py-10"},Z={key:1,class:"text-center py-10 text-red-500"},ee={key:2,class:"bg-white shadow-md rounded-lg overflow-hidden"},te={class:"min-w-full leading-normal"},se={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},re={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},oe={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm"},ae={class:"px-5 py-5 border-b border-gray-200 bg-white text-sm text-right"},le=["onClick"],ne=["onClick"],ie={key:0},de={class:"px-5 py-5 bg-white border-t flex flex-col xs:flex-row items-center xs:justify-between"},ue={class:"text-xs xs:text-sm text-gray-900"},ce={class:"inline-flex mt-2 xs:mt-0"},me=["disabled"],pe=["disabled"],fe={__name:"Users",setup(p){const s=M(),d=j(),n=$(!1),r=$(null);V(()=>{s.fetchUsers(),d.fetchAllReferentials()});const l=t=>{t>0&&t<=s.pagination.totalPages&&s.fetchUsers(t)},a=()=>{r.value=null,n.value=!0},b=t=>{r.value={...t},n.value=!0},w=()=>{n.value=!1,r.value=null},k=async t=>{t.id?await s.updateUser(t.id,t):await s.createUser(t),s.error||w()},c=t=>{window.confirm(`Are you sure you want to delete the user "${t.name}"?`)&&s.deleteUser(t.id)};return(t,o)=>(u(),m("div",null,[e("div",{class:"flex justify-end mb-6"},[e("button",{onClick:a,class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700"}," Create User ")]),i(s).loading?(u(),m("div",Y,"Loading users...")):i(s).error?(u(),m("div",Z,g(i(s).error),1)):(u(),m("div",ee,[e("table",te,[o[3]||(o[3]=e("thead",null,[e("tr",null,[e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Name "),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Email "),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Roles "),e("th",{class:"px-5 py-3 border-b-2 border-gray-200 bg-gray-100"})])],-1)),e("tbody",null,[(u(!0),m(P,null,U(i(s).users,f=>(u(),m("tr",{key:f.id,class:"hover:bg-gray-50"},[e("td",se,g(f.name),1),e("td",re,g(f.email),1),e("td",oe,[(u(!0),m(P,null,U(f.roles,v=>(u(),m("span",{key:v.id,class:"mr-2 inline-block px-2 py-1 text-xs font-semibold text-gray-700 bg-gray-200 rounded-full"},g(v.name),1))),128))]),e("td",ae,[e("button",{onClick:v=>b(f),class:"text-indigo-600 hover:text-indigo-900 mr-4"},"Edit",8,le),e("button",{onClick:v=>c(f),class:"text-red-600 hover:text-red-900"},"Delete",8,ne)])]))),128)),i(s).users.length===0?(u(),m("tr",ie,[...o[2]||(o[2]=[e("td",{colspan:"4",class:"text-center py-10 text-gray-500"},"No users found.",-1)])])):x("",!0)])]),e("div",de,[e("span",ue," Showing "+g(i(s).users.length)+" of "+g(i(s).pagination.total)+" users ",1),e("div",ce,[e("button",{onClick:o[0]||(o[0]=f=>l(i(s).pagination.currentPage-1)),disabled:i(s).pagination.currentPage<=1,class:"text-sm bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-l disabled:opacity-50"}," Prev ",8,me),e("button",{onClick:o[1]||(o[1]=f=>l(i(s).pagination.currentPage+1)),disabled:i(s).pagination.currentPage>=i(s).pagination.totalPages,class:"text-sm bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-r disabled:opacity-50"}," Next ",8,pe)])])])),n.value?(u(),q(X,{key:3,user:r.value,onClose:w,onSave:k},null,8,["user"])):x("",!0)]))}};export{fe as default};
