import{u as h}from"./tickets.575eee5f.js";import{g as S,h as w,o as a,c as d,a as t,i as T,k as g,v as y,H as b,I as _,t as o,j as x,_ as L,E as C,J as V,bQ as j,G as p,b as k,r as D,d as f,w as M}from"./app.c4cf1d9c.js";import{u as A}from"./referentials.d9e3f896.js";const N={class:"space-y-4"},H={class:"flex items-start space-x-4"},q={class:"min-w-0 flex-1"},z={class:"space-y-6"},B={class:"flex-1"},I={class:"bg-gray-100 p-3 rounded-lg"},U={class:"flex items-baseline justify-between"},E={class:"text-sm font-medium text-gray-900"},P={class:"text-xs text-gray-500"},R={class:"mt-1 text-sm text-gray-700"},F={key:0,class:"text-center text-gray-500 py-4"},G={__name:"TicketComments",props:{ticketId:{type:[String,Number],required:!0},comments:{type:Array,default:()=>[]}},setup(r){const u=r,v=h(),e=S("");w(()=>{v.fetchComments(u.ticketId)});const m=async()=>{!e.value.trim()||(await v.postComment(u.ticketId,{comment:e.value}),e.value="")};return(s,n)=>(a(),d("div",N,[t("div",H,[n[3]||(n[3]=t("div",{class:"flex-shrink-0"},[t("span",{class:"inline-block h-10 w-10 rounded-full overflow-hidden bg-gray-100"},[t("svg",{class:"h-full w-full text-gray-300",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M24 20.993V24H0v-2.993A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"})])])],-1)),t("div",q,[t("form",{onSubmit:T(m,["prevent"])},[t("div",null,[n[1]||(n[1]=t("label",{for:"comment",class:"sr-only"},"Add a comment",-1)),g(t("textarea",{id:"comment","onUpdate:modelValue":n[0]||(n[0]=c=>e.value=c),rows:"3",class:"shadow-sm block w-full focus:ring-blue-500 focus:border-blue-500 sm:text-sm border border-gray-300 rounded-md",placeholder:"Add a comment..."},null,512),[[y,e.value]])]),n[2]||(n[2]=t("div",{class:"mt-3 flex items-center justify-end"},[t("button",{type:"submit",class:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Comment ")],-1))],32)])]),t("div",z,[(a(!0),d(b,null,_(r.comments,c=>(a(),d("div",{key:c.id,class:"flex space-x-4"},[n[4]||(n[4]=t("div",{class:"flex-shrink-0"},[t("span",{class:"inline-block h-10 w-10 rounded-full overflow-hidden bg-gray-100"},[t("svg",{class:"h-full w-full text-gray-300",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M24 20.993V24H0v-2.993A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"})])])],-1)),t("div",B,[t("div",I,[t("div",U,[t("p",E,o(c.user.name),1),t("p",P,o(new Date(c.created_at).toLocaleString()),1)]),t("p",R,o(c.comment),1)])])]))),128)),!r.comments||r.comments.length===0?(a(),d("div",F," No comments yet. ")):x("",!0)])]))}};const J={class:"space-y-4"},O={class:"flex justify-between mb-1"},Q={class:"text-base font-medium text-blue-700"},W={class:"text-sm font-medium text-gray-500"},K={class:"w-full bg-gray-200 rounded-full h-2.5"},X=["value"],Y={class:"space-y-2"},Z={class:"font-bold"},tt={key:0,class:"pl-2 text-xs"},et={key:0,class:"text-sm text-gray-500"},st={__name:"TicketTimeLog",props:{ticket:{type:Object,required:!0}},setup(r){var c;const u=r,v=h(),e=A(),m=S({value:"",activity_id:((c=e.activities[0])==null?void 0:c.id)||"",comment:""}),s=C(()=>{if(!u.ticket.estimation||u.ticket.estimation==0)return"0%";const $=u.ticket.total_logged_hours/u.ticket.estimation*100;return`${Math.min($,100)}%`});w(()=>{v.fetchHours(u.ticket.id),e.activities.length===0&&e.fetchAllReferentials()});const n=async()=>{!m.value.value||(await v.logHours(u.ticket.id,m.value),m.value.value="",m.value.comment="")};return($,l)=>(a(),d("div",J,[t("div",null,[t("div",O,[t("span",Q,"Logged: "+o(r.ticket.total_logged_hours||0)+"h",1),t("span",W,"Estimated: "+o(r.ticket.estimation||0)+"h",1)]),t("div",K,[t("div",{class:"bg-blue-600 h-2.5 rounded-full",style:V({width:s.value})},null,4)])]),t("form",{onSubmit:T(n,["prevent"]),class:"space-y-3"},[t("div",null,[l[3]||(l[3]=t("label",{for:"hours",class:"block text-sm font-medium text-gray-700"},"Hours",-1)),g(t("input",{type:"number",id:"hours","onUpdate:modelValue":l[0]||(l[0]=i=>m.value.value=i),step:"0.1",required:"",class:"mt-1 form-input",placeholder:"e.g., 1.5"},null,512),[[y,m.value.value]])]),t("div",null,[l[4]||(l[4]=t("label",{for:"activity",class:"block text-sm font-medium text-gray-700"},"Activity",-1)),g(t("select",{id:"activity","onUpdate:modelValue":l[1]||(l[1]=i=>m.value.activity_id=i),required:"",class:"mt-1 form-select"},[(a(!0),d(b,null,_(p(e).activities,i=>(a(),d("option",{key:i.id,value:i.id},o(i.name),9,X))),128))],512),[[j,m.value.activity_id]])]),t("div",null,[l[5]||(l[5]=t("label",{for:"log-comment",class:"block text-sm font-medium text-gray-700"},"Comment",-1)),g(t("input",{type:"text",id:"log-comment","onUpdate:modelValue":l[2]||(l[2]=i=>m.value.comment=i),class:"mt-1 form-input"},null,512),[[y,m.value.comment]])]),l[6]||(l[6]=t("button",{type:"submit",class:"w-full px-4 py-2 text-white bg-green-600 rounded-md hover:bg-green-700"},"Log Work",-1))],32),t("div",null,[l[7]||(l[7]=t("h4",{class:"font-semibold mb-2"},"History",-1)),t("ul",Y,[(a(!0),d(b,null,_(r.ticket.hours,i=>(a(),d("li",{key:i.id,class:"text-sm text-gray-600"},[t("span",Z,o(i.value)+"h",1),k(" on "+o(new Date(i.created_at).toLocaleDateString())+" by "+o(i.user.name)+" ",1),i.comment?(a(),d("p",tt,'- "'+o(i.comment)+'"',1)):x("",!0)]))),128)),!r.ticket.hours||r.ticket.hours.length===0?(a(),d("li",et,"No time logged yet.")):x("",!0)])])]))}},ot=L(st,[["__scopeId","data-v-47689881"]]),lt={key:0,class:"text-center py-10"},it={key:1,class:"text-center py-10 text-red-500"},nt={key:2,class:"space-y-6"},at={class:"text-sm text-gray-500"},dt={class:"text-3xl font-bold text-gray-800"},rt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},mt={class:"lg:col-span-2 space-y-6"},ct={class:"bg-white p-6 rounded-lg shadow"},ut={class:"text-gray-700 whitespace-pre-wrap"},vt={class:"bg-white p-6 rounded-lg shadow"},gt={class:"lg:col-span-1 space-y-6"},pt={class:"bg-white p-6 rounded-lg shadow"},xt={class:"space-y-4"},ft={class:"mt-1 text-sm text-gray-900"},yt={class:"mt-1 text-sm text-gray-900"},bt={class:"mt-1 text-sm text-gray-900"},_t={class:"mt-1 text-sm text-gray-900"},kt={class:"mt-1 text-sm text-gray-900"},ht={class:"bg-white p-6 rounded-lg shadow"},Tt={__name:"TicketDetail",props:{id:{type:String,required:!0}},setup(r){const u=r,v=h(),e=C(()=>v.ticket);return w(()=>{v.fetchTicket(u.id)}),(m,s)=>{var c;const n=D("router-link");return p(v).loading?(a(),d("div",lt,"Loading ticket details...")):p(v).error?(a(),d("div",it,o(p(v).error),1)):e.value?(a(),d("div",nt,[t("div",null,[t("p",at,[f(n,{to:{name:"ProjectDetail",params:{id:e.value.project.id}},class:"hover:underline"},{default:M(()=>[k(o(e.value.project.name),1)]),_:1},8,["to"]),k(" / "+o(e.value.code),1)]),t("h1",dt,o(e.value.name),1)]),t("div",rt,[t("div",mt,[t("div",ct,[s[0]||(s[0]=t("h3",{class:"font-semibold text-lg mb-2"},"Description",-1)),t("p",ut,o(e.value.description||"No description provided."),1)]),t("div",vt,[s[1]||(s[1]=t("h3",{class:"font-semibold text-lg mb-4"},"Comments",-1)),f(G,{"ticket-id":e.value.id,comments:e.value.comments},null,8,["ticket-id","comments"])])]),t("div",gt,[t("div",pt,[s[7]||(s[7]=t("h3",{class:"font-semibold text-lg mb-4"},"Details",-1)),t("dl",xt,[t("div",null,[s[2]||(s[2]=t("dt",{class:"text-sm font-medium text-gray-500"},"Status",-1)),t("dd",ft,o(e.value.status.name),1)]),t("div",null,[s[3]||(s[3]=t("dt",{class:"text-sm font-medium text-gray-500"},"Priority",-1)),t("dd",yt,o(e.value.priority.name),1)]),t("div",null,[s[4]||(s[4]=t("dt",{class:"text-sm font-medium text-gray-500"},"Type",-1)),t("dd",bt,o(e.value.type.name),1)]),t("div",null,[s[5]||(s[5]=t("dt",{class:"text-sm font-medium text-gray-500"},"Assignee",-1)),t("dd",_t,o(((c=e.value.responsible)==null?void 0:c.name)||"Unassigned"),1)]),t("div",null,[s[6]||(s[6]=t("dt",{class:"text-sm font-medium text-gray-500"},"Reporter",-1)),t("dd",kt,o(e.value.owner.name),1)])])]),t("div",ht,[s[8]||(s[8]=t("h3",{class:"font-semibold text-lg mb-4"},"Time Tracking",-1)),f(ot,{ticket:e.value},null,8,["ticket"])])])])])):x("",!0)}}};export{Tt as default};
