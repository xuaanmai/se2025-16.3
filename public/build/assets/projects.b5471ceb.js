import{m as j,p as i,f}from"./app.c4cf1d9c.js";const P=j("projects",{state:()=>({projects:[],project:null,pagination:{currentPage:1,totalPages:1,total:0,perPage:15},loading:!1,error:null}),actions:{async fetchProjects(e=1,t={}){var r,a,s,n,p,d,g,u;this.loading=!0,this.error=null;try{const l={page:e,...t},c=(await i.get("/projects",{params:l})).data||{},o=c.meta&&typeof c.meta=="object"?c.meta:null,h=Array.isArray(c)?c:c.data||[];this.projects=h,this.pagination={currentPage:(a=(r=o==null?void 0:o.current_page)!=null?r:c.current_page)!=null?a:1,totalPages:(n=(s=o==null?void 0:o.last_page)!=null?s:c.last_page)!=null?n:1,total:(d=(p=o==null?void 0:o.total)!=null?p:c.total)!=null?d:h.length,perPage:(u=(g=o==null?void 0:o.per_page)!=null?g:c.per_page)!=null?u:h.length||15}}catch(l){this.error="Failed to fetch projects.",console.error(l)}finally{this.loading=!1}},async fetchProject(e){this.loading=!0,this.error=null,this.project=null;try{const t=await i.get(`/projects/${e}`);this.project=t.data}catch(t){this.error="Failed to fetch project details.",console.error(t)}finally{this.loading=!1}},async createProject(e){var t,r;this.loading=!0,this.error=null;try{const a=await i.post("/projects",e,{headers:{"Content-Type":"multipart/form-data"}});return await this.fetchProjects(),await f().fetchUser(),a.data.data}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to create project.",console.error(a),a}finally{this.loading=!1}},async updateProject(e,t){var r,a;this.loading=!0,this.error=null;try{const s=await i.post(`/projects/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}});return await this.fetchProjects(this.pagination.currentPage),this.project&&this.project.id===e&&(this.project=s.data.data),s.data.data}catch(s){throw this.error=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to update project.",console.error(s),s}finally{this.loading=!1}},async deleteProject(e){this.loading=!0,this.error=null;try{await i.delete(`/projects/${e}`),await this.fetchProjects(this.pagination.currentPage)}catch(t){throw this.error="Failed to delete project.",console.error(t),t}finally{this.loading=!1}},async toggleFavorite(e){try{const t=await i.post(`/projects/${e}/favorite`),r=this.projects.findIndex(a=>a.id===e);r!==-1&&(this.projects[r].is_favorite=t.data.is_favorite)}catch(t){console.error("Failed to toggle favorite status:",t)}},async fetchProjectMembers(e){try{const r=(await i.get(`/projects/${e}/users`)).data||[];return this.project&&this.project.id==e&&(this.project.users=r),r}catch(t){return console.error("Failed to fetch project members:",t),[]}},async attachUser(e,t){var r,a;try{await i.post(`/projects/${e}/users`,t),await this.fetchProjectMembers(e)}catch(s){throw console.error("Failed to attach user:",s),this.error=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to attach user.",s}},async updateUserRole(e,t,r){var a,s;try{await i.put(`/projects/${e}/users/${t}`,{role:r}),await this.fetchProjectMembers(e)}catch(n){throw console.error("Failed to update user role:",n),this.error=((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update role.",n}},async detachUser(e,t){var r,a;try{await i.delete(`/projects/${e}/users/${t}`),await this.fetchProjectMembers(e)}catch(s){throw console.error("Failed to detach user:",s),this.error=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to detach user.",s}},async fetchSprints(e){try{const t=await i.get(`/projects/${e}/sprints`);return this.project&&this.project.id==e&&(this.project.sprints=t.data),t.data}catch(t){return console.error("Failed to fetch sprints:",t),[]}},async fetchActiveProjects(e=1){this.loading=!0,this.error=null;try{const t=await i.get(`/projects/active?page=${e}`);this.projects=t.data.data,this.pagination.currentPage=t.data.current_page,this.pagination.totalPages=t.data.last_page,this.pagination.total=t.data.total}catch(t){this.error="Failed to fetch active projects.",console.error(t)}finally{this.loading=!1}}}});export{P as u};
