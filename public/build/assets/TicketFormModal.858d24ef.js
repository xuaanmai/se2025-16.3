import{m as I,bU as O,_ as R,f as z,g as M,E as T,A as F,o as l,c as a,a as i,t as n,i as A,G as r,j as x,k as d,bQ as f,H as m,I as p,v as w}from"./app.c4cf1d9c.js";import{u as G}from"./tickets.575eee5f.js";import{u as H}from"./projects.b5471ceb.js";import{u as Q}from"./referentials.d9e3f896.js";const J=I("epics",{state:()=>({epics:[],loading:!1,error:null}),actions:{async fetchEpics(S){if(!S){this.epics=[];return}this.loading=!0,this.error=null;try{const b=await O.get(`/api/epics?project_id=${S}&per_page=-1`);this.epics=b.data}catch(b){this.error="Failed to load epics.",console.error("Failed to load epics:",b)}finally{this.loading=!1}}}});const K={class:"relative mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white"},W={class:"mt-3"},X={class:"text-lg leading-6 font-medium text-gray-900 text-center"},Y={key:0,class:"mb-4 rounded-md bg-red-50 p-4"},Z={class:"text-sm font-medium text-red-800"},h={key:1},ee=["value"],te={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie=["value"],se=["value"],oe={key:0},le=["value"],ae=["disabled"],re={key:0,value:""},de=["label"],ne=["value"],ue=["disabled"],me={key:0,value:""},pe=["value"],ce={class:"items-center pt-4"},ve=["disabled"],fe={__name:"TicketFormModal",props:{ticket:{type:Object,default:null}},emits:["close","save"],setup(S,{emit:b}){const y=S,D=b,k=G(),P=H(),u=Q(),g=J(),N=z(),s=M({}),c=M([]),j=M(!1),U=T(()=>!!(y.ticket&&y.ticket.id)),q=T(()=>U.value||y.ticket&&y.ticket.project_id),C=T(()=>U.value?"Edit Ticket":"Create New Ticket"),E=o=>o?new Date(o).toISOString().split("T")[0]:"",L=o=>{var t,_,v;const e={id:null,name:"",description:"",project_id:"",owner_id:(t=N.user)==null?void 0:t.id,responsible_id:"",status_id:"",priority_id:((_=u.ticketPriorities.find(V=>V.is_default))==null?void 0:_.id)||"",type_id:((v=u.ticketTypes.find(V=>V.is_default))==null?void 0:v.id)||"",epic_id:"",estimation:null,start_date:"",due_date:""};o?s.value={...e,id:o.id,name:o.name,description:o.description||"",project_id:o.project_id,responsible_id:o.responsible_id||"",status_id:o.status_id,priority_id:o.priority_id,type_id:o.type_id,epic_id:o.epic_id||"",estimation:o.estimation,start_date:E(o.start_date),due_date:E(o.due_date)}:s.value=e,k.error=null},$=T(()=>c.value?c.value.reduce((o,e)=>{const t=e.pivot.role||"Unknown";return o[t]||(o[t]=[]),o[t].push(e),o},{}):{});F(()=>y.ticket,async o=>{u.isLoaded||await u.fetchAllReferentials(),L(o)},{immediate:!0}),F(()=>s.value.project_id,async o=>{o?(j.value=!0,c.value=await P.fetchProjectMembers(o),j.value=!1,await g.fetchEpics(o),Array.isArray(c.value)&&c.value.some(t=>t.id===s.value.responsible_id)||(s.value.responsible_id="")):(c.value=[],g.epics=[])},{immediate:!0});const B=()=>{D("save",{...s.value})};return(o,e)=>(l(),a("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center",onClick:e[12]||(e[12]=A(t=>o.$emit("close"),["self"]))},[i("div",K,[i("div",W,[i("h3",X,n(C.value),1),i("form",{onSubmit:A(B,["prevent"]),class:"mt-4 px-4 py-3 text-left space-y-4"},[r(k).error?(l(),a("div",Y,[i("p",Z,n(r(k).error),1)])):x("",!0),q.value?x("",!0):(l(),a("div",h,[e[14]||(e[14]=i("label",{for:"ticket-project",class:"block text-sm font-medium text-gray-700"},"Project",-1)),d(i("select",{id:"ticket-project","onUpdate:modelValue":e[0]||(e[0]=t=>s.value.project_id=t),required:"",class:"mt-1 form-select"},[e[13]||(e[13]=i("option",{disabled:"",value:""},"Please select a project",-1)),(l(!0),a(m,null,p(r(u).projects,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,ee))),128))],512),[[f,s.value.project_id]])])),i("div",null,[e[15]||(e[15]=i("label",{for:"ticket-name",class:"block text-sm font-medium text-gray-700"},"Ticket Title",-1)),d(i("input",{type:"text",id:"ticket-name","onUpdate:modelValue":e[1]||(e[1]=t=>s.value.name=t),required:"",class:"mt-1 form-input"},null,512),[[w,s.value.name]])]),i("div",te,[i("div",null,[e[16]||(e[16]=i("label",{for:"ticket-type",class:"block text-sm font-medium text-gray-700"},"Type",-1)),d(i("select",{id:"ticket-type","onUpdate:modelValue":e[2]||(e[2]=t=>s.value.type_id=t),required:"",class:"mt-1 form-select"},[(l(!0),a(m,null,p(r(u).ticketTypes,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,ie))),128))],512),[[f,s.value.type_id]])]),i("div",null,[e[17]||(e[17]=i("label",{for:"ticket-priority",class:"block text-sm font-medium text-gray-700"},"Priority",-1)),d(i("select",{id:"ticket-priority","onUpdate:modelValue":e[3]||(e[3]=t=>s.value.priority_id=t),required:"",class:"mt-1 form-select"},[(l(!0),a(m,null,p(r(u).ticketPriorities,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,se))),128))],512),[[f,s.value.priority_id]])]),U.value?(l(),a("div",oe,[e[18]||(e[18]=i("label",{for:"ticket-status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),d(i("select",{id:"ticket-status","onUpdate:modelValue":e[4]||(e[4]=t=>s.value.status_id=t),required:"",class:"mt-1 form-select"},[(l(!0),a(m,null,p(r(u).ticketStatuses,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,le))),128))],512),[[f,s.value.status_id]])])):x("",!0),i("div",null,[e[20]||(e[20]=i("label",{for:"ticket-assignee",class:"block text-sm font-medium text-gray-700"},"Assignee",-1)),d(i("select",{id:"ticket-assignee","onUpdate:modelValue":e[5]||(e[5]=t=>s.value.responsible_id=t),class:"mt-1 form-select",disabled:!s.value.project_id||j.value},[e[19]||(e[19]=i("option",{value:""},"Unassigned",-1)),j.value?(l(),a("option",re,"Loading members...")):x("",!0),(l(!0),a(m,null,p($.value,(t,_)=>(l(),a("optgroup",{key:_,label:_},[(l(!0),a(m,null,p(t,v=>(l(),a("option",{key:v.id,value:v.id},n(v.name),9,ne))),128))],8,de))),128))],8,ae),[[f,s.value.responsible_id]])]),i("div",null,[e[22]||(e[22]=i("label",{for:"ticket-epic",class:"block text-sm font-medium text-gray-700"},"Epic",-1)),d(i("select",{id:"ticket-epic","onUpdate:modelValue":e[6]||(e[6]=t=>s.value.epic_id=t),class:"mt-1 form-select",disabled:!s.value.project_id||r(g).loading},[e[21]||(e[21]=i("option",{value:""},"None",-1)),r(g).loading?(l(),a("option",me,"Loading epics...")):x("",!0),(l(!0),a(m,null,p(r(g).epics,t=>(l(),a("option",{key:t.id,value:t.id},n(t.name),9,pe))),128))],8,ue),[[f,s.value.epic_id]])]),i("div",null,[e[23]||(e[23]=i("label",{for:"ticket-estimation",class:"block text-sm font-medium text-gray-700"},"Estimation (hours)",-1)),d(i("input",{type:"number",step:"0.5",min:"0",id:"ticket-estimation","onUpdate:modelValue":e[7]||(e[7]=t=>s.value.estimation=t),class:"mt-1 form-input"},null,512),[[w,s.value.estimation]])]),i("div",null,[e[24]||(e[24]=i("label",{for:"ticket-start-date",class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),d(i("input",{type:"date",id:"ticket-start-date","onUpdate:modelValue":e[8]||(e[8]=t=>s.value.start_date=t),class:"mt-1 form-input"},null,512),[[w,s.value.start_date]])]),i("div",null,[e[25]||(e[25]=i("label",{for:"ticket-due-date",class:"block text-sm font-medium text-gray-700"},"Due Date",-1)),d(i("input",{type:"date",id:"ticket-due-date","onUpdate:modelValue":e[9]||(e[9]=t=>s.value.due_date=t),class:"mt-1 form-input"},null,512),[[w,s.value.due_date]])])]),i("div",null,[e[26]||(e[26]=i("label",{for:"ticket-description",class:"block text-sm font-medium text-gray-700"},"Description",-1)),d(i("textarea",{id:"ticket-description","onUpdate:modelValue":e[10]||(e[10]=t=>s.value.description=t),rows:"4",class:"mt-1 form-input"},null,512),[[w,s.value.description]])]),i("div",ce,[i("button",{type:"submit",disabled:r(k).loading,class:"w-full px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"},n(r(k).loading?"Saving...":"Save Ticket"),9,ve),i("button",{type:"button",onClick:e[11]||(e[11]=t=>o.$emit("close")),class:"w-full px-4 py-2 mt-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Cancel ")])],32)])])]))}},_e=R(fe,[["__scopeId","data-v-52114b38"]]);export{_e as T};
